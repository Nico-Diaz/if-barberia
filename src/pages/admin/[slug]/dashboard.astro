---
// src/pages/admin/[slug]/dashboard.astro

// 1. IMPORT
import Layout from '../../../layouts/Layout.astro';
import { createClient } from '@supabase/supabase-js';

const { slug } = Astro.params;
const supabase = createClient(import.meta.env.PUBLIC_SUPABASE_URL, import.meta.env.PUBLIC_SUPABASE_ANON_KEY);
const { data: negocio } = await supabase.from('negocios').select('*').eq('slug', slug).single();

if (!negocio) return Astro.redirect('/404');

const SUPABASE_URL = import.meta.env.PUBLIC_SUPABASE_URL;
const SUPABASE_KEY = import.meta.env.PUBLIC_SUPABASE_ANON_KEY;
---

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/themes/dark.css">
<script is:inline src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script is:inline src="https://npmcdn.com/flatpickr/dist/l10n/es.js"></script>

<Layout title={`Admin - ${negocio.nombre}`}>
    <main class="admin-wrapper" style="display: none;" id="main-admin">
        
        <header class="admin-header">
            <div class="header-inner">
                <div class="brand">
                    <span class="icon">‚öôÔ∏è</span>
                    <h1>PANEL DE CONTROL</h1>
                </div>
                <button id="btn-logout" class="btn-logout">
                    <span class="text">Cerrar Sesi√≥n</span> 
                    <span class="icon-exit">üîì</span>
                </button>
            </div>
        </header>

        <nav class="admin-nav">
            <button class="tab-btn active" id="btn-turnos">üìÖ Agenda</button>
            <button class="tab-btn" id="btn-servicios">üí∞ Servicios</button>
            <button class="tab-btn" id="btn-equipo">üíà Equipo</button>
            <button class="tab-btn" id="btn-bloqueos">‚õî Bloqueos</button>
            <button class="tab-btn" id="btn-historial">üìÅ Historial</button>
        </nav>

        <div class="content-area">
            
            <div id="tab-turnos" class="tab-content active">
                <div class="toolbar">
                    <h2>Pr√≥ximos Turnos</h2>
                    <button id="refresh-turnos" class="btn-refresh">üîÑ Actualizar</button>
                </div>
                <div id="lista-turnos" class="grid-turnos">
                    <p class="loading">Cargando...</p>
                </div>
            </div>

            <div id="tab-servicios" class="tab-content" style="display: none;">
                <h2>Gestionar Precios</h2>
                <div id="lista-servicios" class="list-editor"></div>
                <form id="form-add-servicio" class="add-form">
                    <input type="text" name="nombre" placeholder="Nuevo servicio..." required>
                    <input type="number" name="precio" placeholder="Precio ($)" required>
                    <button type="submit">‚ûï Agregar</button>
                </form>
            </div>

            <div id="tab-equipo" class="tab-content" style="display: none;">
                <h2>Gestionar Barberos</h2>
                <p class="section-desc">Configura los horarios y descansos.</p>
                <div id="lista-barberos" class="list-editor"></div>
                <form id="form-add-barbero" class="add-form">
                    <input type="text" name="nombre" placeholder="Nombre..." required>
                    <button type="submit">‚ûï Agregar Barbero</button>
                </form>
            </div>

            <div id="tab-bloqueos" class="tab-content" style="display: none;">
                <h2>Bloquear D√≠as</h2>
                <div class="block-controls">
                    <div class="input-icon-container" style="flex: 2;">
                        <input type="text" id="fecha-bloqueo" placeholder="Toca para elegir el d√≠a..." class="input-flatpickr" readonly>
                    </div>
                    <button id="btn-bloquear" class="btn-danger" style="flex: 1;">‚õî Bloquear D√≠a</button>
                </div>
                <h3 style="margin-top:20px; color:#94a3b8; font-size:0.9rem;">D√≠as Cerrados:</h3>
                <ul id="lista-bloqueos" class="simple-list"></ul>
            </div>

            <div id="tab-historial" class="tab-content" style="display: none;">
                <h2>Historial y Exportaci√≥n</h2>
                <p class="section-desc">Descarga la base de datos completa de turnos (pasados y futuros) para abrir en Google Sheets o Excel.</p>
                
                <div class="export-card">
                    <div class="export-info">
                        <span style="font-size: 3rem;">üìä</span>
                        <div>
                            <h3>Base de Datos Completa</h3>
                            <p style="color: #94a3b8; font-size: 0.9rem;">Incluye: Fecha, Hora, Cliente, Tel√©fono, Servicio y Profesional.</p>
                        </div>
                    </div>
                    <button id="btn-download-csv" class="btn-download">
                        üì• Descargar Archivo .CSV
                    </button>
                    <p id="export-status" style="margin-top: 10px; font-size: 0.85rem; color: #fbbf24; display: none;"></p>
                </div>
            </div>

        </div>
    </main>
</Layout>

<script type="module" define:vars={{ SUPABASE_URL, SUPABASE_KEY, NEGOCIO_ID: negocio.id, SLUG: negocio.slug }}>
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm';
    const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

    // --- AUTH ---
    async function checkAuth() {
        const { data: { session } } = await supabase.auth.getSession();
        if (!session) {
            localStorage.setItem('redirect_after_login', window.location.href);
            window.location.href = '/admin/login';
        } else {
            document.getElementById('main-admin').style.display = 'block';
            initDashboard();
        }
    }
    checkAuth();

    // --- REFS ---
    const listaTurnos = document.getElementById('lista-turnos');
    const listaServicios = document.getElementById('lista-servicios');
    const listaBarberos = document.getElementById('lista-barberos');
    const listaBloqueos = document.getElementById('lista-bloqueos');

    function initDashboard() {
        if(typeof flatpickr !== 'undefined') {
            flatpickr("#fecha-bloqueo", { locale: "es", dateFormat: "Y-m-d", minDate: "today", disableMobile: true, theme: "dark" });
        }
        cargarTurnos();
        cargarServicios();
        cargarBarberos();
        cargarBloqueos();
    }

    // --- CARGA ---
    async function cargarTurnos() {
        listaTurnos.innerHTML = '<p class="loading">Cargando...</p>';
        const hoy = new Date().toISOString().split('T')[0];
        const { data, error } = await supabase.from('turnos').select('*').eq('negocio_id', NEGOCIO_ID).gte('fecha', hoy).order('fecha').order('hora');
        
        if (error || !data || data.length === 0) { 
            listaTurnos.innerHTML = '<p class="empty">No hay turnos pr√≥ximos.</p>'; return; 
        }

        listaTurnos.innerHTML = data.map(t => {
            const telefono = t.cliente_telefono ? t.cliente_telefono.replace(/\D/g, '') : '';
            const mensaje = `Hola ${t.cliente_nombre}, te escribo de la Barber√≠a para confirmar tu turno el d√≠a ${t.fecha.split('-').reverse().join('/')} a las ${t.hora.slice(0,5)} hs. üíà`;
            const linkWsp = telefono ? `https://wa.me/549${telefono}?text=${encodeURIComponent(mensaje)}` : '#';

            return `
            <div class="card-turno">
                <div class="turno-header">
                    <span class="fecha-hora">üìÖ ${t.fecha.split('-').reverse().join('/')} - ${t.hora.slice(0,5)} hs</span>
                    <span class="servicio-tag">${t.servicio}</span>
                </div>
                <div class="turno-body">
                    <strong>${t.cliente_nombre} ${t.cliente_apellido}</strong>
                    <div class="meta">
                        <span>üíà ${t.profesional}</span>
                    </div>
                </div>
                
                <div class="turno-actions" style="display:flex; gap:10px; margin-top:15px; border-top:1px solid #334155; padding-top:10px;">
                    ${telefono ? `
                        <a href="${linkWsp}" target="_blank" class="btn-wsp" style="flex:1; text-align:center; background:#22c55e; color:white; padding:8px; border-radius:6px; text-decoration:none; font-size:0.9rem; font-weight:bold; display:flex; align-items:center; justify-content:center; gap:5px;">
                            üì± WhatsApp
                        </a>
                    ` : '<span style="flex:1; text-align:center; color:#64748b; font-size:0.8rem; padding:8px; border:1px dashed #475569; border-radius:6px;">Sin Tel√©fono</span>'}
                    
                    <button class="btn-delete-sm action-btn" data-action="delete-turno" data-id="${t.id}" title="Cancelar" style="position:static; background:#ef4444; color:white; border:none; border-radius:6px; width:45px; font-size:1.2rem; cursor:pointer;">
                        üóëÔ∏è
                    </button>
                </div>
            </div>
            `;
        }).join('');
    }

    async function cargarServicios() {
        const { data } = await supabase.from('servicios').select('*').eq('negocio_id', NEGOCIO_ID).order('precio');
        
        listaServicios.innerHTML = data ? data.map(s => `
            <div class="row-editor">
                <input type="text" value="${s.nombre}" id="name-${s.id}" placeholder="Nombre">
                <input type="number" value="${s.precio}" id="price-${s.id}" placeholder="Precio">
                
                <div class="service-actions-group">
                    <button class="btn-save action-btn" data-action="save-servicio" data-id="${s.id}" title="Guardar">üíæ</button>
                    <button class="btn-del-serv action-btn" data-action="delete-servicio" data-id="${s.id}" title="Borrar">‚ùå</button>
                </div>
            </div>
        `).join('') : '<p class="empty">Sin servicios creados.</p>';
    }

    async function cargarBarberos() {
        const { data } = await supabase.from('profesionales').select('*').eq('negocio_id', NEGOCIO_ID).order('created_at');
        if (!data || data.length === 0) { listaBarberos.innerHTML = '<p class="empty">No hay barberos.</p>'; return; }
        
        listaBarberos.innerHTML = data.map(p => {
            const defaultH = {"1":{"i":"10:00","f":"20:00","activo":true},"2":{"i":"10:00","f":"20:00","activo":true},"3":{"i":"10:00","f":"20:00","activo":true},"4":{"i":"10:00","f":"20:00","activo":true},"5":{"i":"10:00","f":"20:00","activo":true},"6":{"i":"10:00","f":"20:00","activo":true},"0":{"i":"10:00","f":"20:00","activo":false}};
            const h = p.horarios || defaultH;
            const dias = [{k:"1",l:"Lun"},{k:"2",l:"Mar"},{k:"3",l:"Mi√©"},{k:"4",l:"Jue"},{k:"5",l:"Vie"},{k:"6",l:"S√°b"}];

            const gridDias = dias.map(d => {
                const dd = h[d.k] || {i: "10:00", f: "20:00", activo: false, break: false, bi: "13:00", bf: "14:00"};
                const rowClass = dd.activo ? 'day-active' : 'day-inactive';
                const breakClass = dd.break ? 'break-active' : '';

                return `
                    <div class="day-row ${rowClass}">
                        <div class="day-main">
                            <label class="day-check">
                                <input type="checkbox" id="check-${p.id}-${d.k}" ${dd.activo?'checked':''} class="toggle-day"> 
                                <span class="day-label">${d.l}</span>
                            </label>
                            <div class="time-group">
                                <span class="icon">‚òÄÔ∏è</span>
                                <input type="time" value="${dd.i}" id="ini-${p.id}-${d.k}" class="time-input" ${!dd.activo?'disabled':''}> 
                                <span class="sep">a</span> 
                                <input type="time" value="${dd.f}" id="fin-${p.id}-${d.k}" class="time-input" ${!dd.activo?'disabled':''}>
                            </div>
                        </div>
                        <div class="day-break ${breakClass}">
                            <label class="break-check" title="Activar Descanso">
                                <input type="checkbox" id="bcheck-${p.id}-${d.k}" ${dd.break?'checked':''} class="toggle-break" ${!dd.activo?'disabled':''}>
                                <span class="icon">‚òï Break</span>
                            </label>
                            <div class="break-inputs ${!dd.break ? 'hidden' : ''}">
                                <input type="time" value="${dd.bi || '13:00'}" id="bini-${p.id}-${d.k}" class="time-xs"> 
                                <span class="sep">-</span> 
                                <input type="time" value="${dd.bf || '14:00'}" id="bfin-${p.id}-${d.k}" class="time-xs">
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            return `
            <div class="barber-card-wrapper">
                <div class="row-editor barber-main-row">
                    <div class="barber-name-group">
                        <span class="avatar">üíà</span>
                        <input type="text" value="${p.nombre}" id="barb-${p.id}" class="name-input">
                    </div>
                    <div class="barber-actions">
                        <button class="btn-toggle-week action-btn" data-action="toggle-week" data-id="${p.id}">üìÖ Horarios</button>
                        <button class="btn-save-barb action-btn" data-action="save-barbero" data-id="${p.id}">üíæ</button>
                        <button class="btn-del-barb action-btn" data-action="delete-barbero" data-id="${p.id}">üóëÔ∏è</button>
                    </div>
                </div>
                <div id="week-${p.id}" class="week-config">
                    <div class="week-header"><span>D√≠a Laboral</span><span>Descanso</span></div>
                    <div class="week-grid">${gridDias}</div>
                </div>
            </div>
            `;
        }).join('');
    }

    async function cargarBloqueos() {
        const hoy = new Date().toISOString().split('T')[0];
        const { data } = await supabase.from('dias_especiales').select('*').eq('negocio_id', NEGOCIO_ID).gte('fecha', hoy);
        listaBloqueos.innerHTML = data ? data.map(d => `
            <li>
                <span style="font-weight:bold; color:white;">üìÖ ${d.fecha.split('-').reverse().join('/')}</span>
                <button class="action-btn" data-action="delete-bloqueo" data-id="${d.id}" style="background:transparent; border:none; font-size:1.2rem; cursor:pointer;">‚ùå</button>
            </li>
        `).join('') : '';
    }

    // --- L√ìGICA DE EXPORTACI√ìN CSV ---
    async function descargarHistorial() {
        const btn = document.getElementById('btn-download-csv');
        const status = document.getElementById('export-status');
        
        btn.disabled = true;
        btn.innerText = "‚è≥ Generando archivo...";
        status.style.display = 'block';
        status.innerText = "Consultando base de datos completa...";

        try {
            // 1. Obtener TODOS los turnos (sin filtro de fecha)
            const { data, error } = await supabase
                .from('turnos')
                .select('*')
                .eq('negocio_id', NEGOCIO_ID)
                .order('fecha', { ascending: false })
                .order('hora', { ascending: true });

            if (error) throw error;
            if (!data || data.length === 0) {
                alert("No hay historial de turnos para descargar.");
                btn.disabled = false;
                btn.innerText = "üì• Descargar Archivo .CSV";
                status.style.display = 'none';
                return;
            }

            // 2. Crear contenido CSV
            status.innerText = `Procesando ${data.length} registros...`;
            
            // Cabeceras
            let csvContent = "Fecha,Hora,Cliente Nombre,Cliente Apellido,Telefono,Servicio,Profesional\n";

            // Filas
            data.forEach(row => {
                // Limpiamos datos para evitar errores con las comas del CSV
                const fecha = row.fecha;
                const hora = row.hora;
                const nombre = (row.cliente_nombre || "").replace(/,/g, " ");
                const apellido = (row.cliente_apellido || "").replace(/,/g, " ");
                const tel = (row.cliente_telefono || "").replace(/,/g, "");
                const serv = (row.servicio || "").replace(/,/g, " ");
                const prof = (row.profesional || "").replace(/,/g, " ");

                csvContent += `${fecha},${hora},${nombre},${apellido},${tel},${serv},${prof}\n`;
            });

            // 3. Crear Blob y descargar
            // \uFEFF es para que Excel reconozca los acentos (BOM)
            const blob = new Blob(["\uFEFF" + csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            
            const link = document.createElement("a");
            link.setAttribute("href", url);
            const fechaHoy = new Date().toISOString().split('T')[0];
            link.setAttribute("download", `historial_turnos_${SLUG}_${fechaHoy}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            status.innerText = "‚úÖ Descarga iniciada correctamente.";
            setTimeout(() => { status.style.display = 'none'; }, 3000);

        } catch (err) {
            console.error(err);
            alert("Error al descargar: " + err.message);
            status.innerText = "‚ùå Error en la descarga.";
        } finally {
            btn.disabled = false;
            btn.innerText = "üì• Descargar Archivo .CSV";
        }
    }

    document.getElementById('btn-download-csv').addEventListener('click', descargarHistorial);

    // --- EVENTOS GENERALES ---
    document.getElementById('btn-logout').addEventListener('click', async () => {
        if(confirm('¬øCerrar sesi√≥n?')) { await supabase.auth.signOut(); window.location.href = '/admin/login'; }
    });

    ['turnos', 'servicios', 'equipo', 'bloqueos', 'historial'].forEach(tab => {
        document.getElementById(`btn-${tab}`).addEventListener('click', () => {
            document.querySelectorAll('.tab-content').forEach(el => el.style.display = 'none');
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            document.getElementById(`tab-${tab}`).style.display = 'block';
            document.getElementById(`btn-${tab}`).classList.add('active');
        });
    });

    document.body.addEventListener('click', async (e) => {
        if(e.target.classList.contains('toggle-day')) {
            const row = e.target.closest('.day-row');
            const isActive = e.target.checked;
            row.classList.toggle('day-active', isActive); row.classList.toggle('day-inactive', !isActive);
            row.querySelectorAll('input[type="time"], .toggle-break').forEach(inp => inp.disabled = !isActive);
        }
        if(e.target.classList.contains('toggle-break')) {
            const container = e.target.closest('.day-break');
            const isActive = e.target.checked;
            container.classList.toggle('break-active', isActive);
            container.querySelector('.break-inputs').classList.toggle('hidden', !isActive);
        }

        const btn = e.target.closest('.action-btn'); if (!btn) return;
        e.preventDefault();
        const action = btn.dataset.action; const id = btn.dataset.id;

        try {
            if (action === 'toggle-week') { 
                document.getElementById(`week-${id}`).classList.toggle('open'); 
                btn.classList.toggle('active');
            }
            else if (action === 'delete-turno') { if(confirm('¬øCancelar Turno?')) { await supabase.from('turnos').delete().eq('id', id); cargarTurnos(); } }
            else if (action === 'save-servicio') {
                const nombre = document.getElementById(`name-${id}`).value;
                const precio = document.getElementById(`price-${id}`).value;
                await supabase.from('servicios').update({ nombre, precio }).eq('id', id); alert('Actualizado');
            }
            else if (action === 'delete-servicio') { if(confirm('¬øBorrar?')) { await supabase.from('servicios').delete().eq('id', id); cargarServicios(); } }
            else if (action === 'save-barbero') {
                const nombre = document.getElementById(`barb-${id}`).value;
                let nuevosH = {}; nuevosH["0"] = {"i":"10:00","f":"20:00","activo":false};
                for(let i=1; i<=6; i++) {
                    const k = i.toString();
                    const check = document.getElementById(`check-${id}-${k}`);
                    if(check) {
                         nuevosH[k] = {
                            activo: check.checked,
                            i: document.getElementById(`ini-${id}-${k}`).value,
                            f: document.getElementById(`fin-${id}-${k}`).value,
                            break: document.getElementById(`bcheck-${id}-${k}`).checked,
                            bi: document.getElementById(`bini-${id}-${k}`).value,
                            bf: document.getElementById(`bfin-${id}-${k}`).value
                        };
                    }
                }
                await supabase.from('profesionales').update({ nombre, horarios: nuevosH }).eq('id', id); alert('Guardado');
            }
            else if (action === 'delete-barbero') { if(confirm('¬øBorrar?')) { await supabase.from('profesionales').delete().eq('id', id); cargarBarberos(); } }
            else if (action === 'delete-bloqueo') { await supabase.from('dias_especiales').delete().eq('id', id); cargarBloqueos(); }
        } catch (err) { console.error(err); alert(err.message); }
    });

    // Forms
    document.getElementById('form-add-servicio').addEventListener('submit', async (e) => {
        e.preventDefault(); const form = new FormData(e.target);
        await supabase.from('servicios').insert({ negocio_id: NEGOCIO_ID, nombre: form.get('nombre'), precio: form.get('precio') });
        e.target.reset(); cargarServicios();
    });
    document.getElementById('form-add-barbero').addEventListener('submit', async (e) => {
        e.preventDefault(); const form = new FormData(e.target);
        const defaultH = {"1":{"i":"10:00","f":"20:00","activo":true},"2":{"i":"10:00","f":"20:00","activo":true},"3":{"i":"10:00","f":"20:00","activo":true},"4":{"i":"10:00","f":"20:00","activo":true},"5":{"i":"10:00","f":"20:00","activo":true},"6":{"i":"10:00","f":"20:00","activo":true},"0":{"i":"10:00","f":"20:00","activo":false}};
        await supabase.from('profesionales').insert({ negocio_id: NEGOCIO_ID, nombre: form.get('nombre'), horarios: defaultH });
        e.target.reset(); cargarBarberos();
    });
    document.getElementById('btn-bloquear').addEventListener('click', async () => {
        const fecha = document.getElementById('fecha-bloqueo').value;
        if(!fecha) return alert('Por favor selecciona una fecha');
        await supabase.from('dias_especiales').insert({ negocio_id: NEGOCIO_ID, fecha, motivo: 'Cerrado', cerrado: true });
        cargarBloqueos();
    });
    document.getElementById('refresh-turnos').addEventListener('click', cargarTurnos);
</script>

<style is:global>
    /* VARIABLES DE COLORES */
    :root { 
        --barber-red: #D92525; 
        --barber-blue: #1E3A8A; 
        --bg-dark: #0f172a; 
        --bg-card: #1e293b; 
        --text-muted: #94a3b8; 
        --border: #334155; 
    }
    
    /* RESET GLOBAL (Evita bordes blancos) */
    html, body {
        margin: 0;
        padding: 0;
        width: 100%;
        min-height: 100vh;
        background-color: var(--bg-dark);
        font-family: system-ui, -apple-system, sans-serif;
        overflow-x: hidden;
    }

    * { box-sizing: border-box; }

    /* LAYOUT PRINCIPAL */
    .admin-wrapper { min-height: 100vh; color: white; padding-bottom: 80px; width: 100%; }
    .content-area { padding: 20px 15px; width: 100%; max-width: 900px; margin: 0 auto; }

    /* HEADER */
    .admin-header { 
        background: var(--bg-card); 
        padding: 1rem; 
        border-bottom: 1px solid var(--border); 
        position: sticky; top: 0; z-index: 100;
        box-shadow: 0 4px 20px rgba(0,0,0,0.4);
    }
    .header-inner { display: flex; justify-content: space-between; align-items: center; max-width: 900px; margin: 0 auto; }
    
    .brand { display: flex; align-items: center; gap: 10px; }
    .brand h1 { margin: 0; font-size: 1.1rem; font-weight: 800; letter-spacing: 1px; color: white; text-transform: uppercase; }
    
    .btn-logout { 
        background: rgba(255,255,255,0.05); 
        border: 1px solid rgba(255,255,255,0.1); 
        color: var(--text-muted); 
        padding: 8px 12px; 
        border-radius: 8px; 
        cursor: pointer; font-size: 0.85rem; 
        display: flex; align-items: center; gap: 6px; transition: 0.2s; 
    }
    .btn-logout:hover { background: var(--barber-red); color: white; border-color: var(--barber-red); }

    /* NAV HORIZONTAL (Mobile Friendly) */
    .admin-nav { 
        display: flex; 
        flex-direction: row;        /* Fila horizontal */
        flex-wrap: nowrap;          /* NO bajar de l√≠nea */
        overflow-x: auto;           /* Scroll horizontal */
        justify-content: flex-start; /* Alineado a la izq en m√≥vil */
        gap: 10px; 
        padding: 15px 20px; 
        width: 100%;
        background: rgba(15, 23, 42, 0.95);
        backdrop-filter: blur(5px);
        border-bottom: 1px solid var(--border);
        
        /* Suavidad Scroll */
        -webkit-overflow-scrolling: touch; 
        scrollbar-width: none; 
    }
    .admin-nav::-webkit-scrollbar { display: none; }

    .tab-btn { 
        flex: 0 0 auto; /* Evita que se encoja */
        white-space: nowrap;
        padding: 10px 20px; 
        background: transparent; 
        border: 1px solid transparent; 
        color: var(--text-muted); 
        font-weight: 600; 
        cursor: pointer; 
        border-radius: 8px; 
        transition: 0.2s; 
        font-size: 0.9rem;
    }
    .tab-btn:hover { background: rgba(255,255,255,0.05); color: white; }
    .tab-btn.active { 
        background: var(--barber-blue); 
        color: white; 
        box-shadow: 0 4px 12px rgba(30, 58, 138, 0.4); 
        border-color: rgba(255,255,255,0.1);
    }

    @media (min-width: 768px) {
        .admin-nav { justify-content: center; } /* Centrado en PC */
    }

    /* CONTENIDO DE PESTA√ëAS */
    .tab-content { display: none; animation: fadeIn 0.3s ease-out; }
    .tab-content.active { display: block; }
    
    .section-desc { color: #64748b; margin-bottom: 25px; text-align: center; font-size: 0.95rem; }
    .toolbar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    .btn-refresh { background: var(--barber-blue); color: white; border: none; padding: 8px 15px; border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 0.85rem; }

    .layout-centro {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            width: 100%;
            padding: 20px;
            box-sizing: border-box;
        }

   /* TARJETAS DE TURNOS */
    .grid-turnos { display: grid; gap: 15px; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); }
    
    .card-turno { 
        background: var(--bg-card); 
        border: 1px solid var(--border); 
        border-radius: 12px; padding: 20px; 
        position: relative; 
        border-left: 4px solid var(--barber-blue); 
        box-shadow: 0 4px 6px rgba(0,0,0,0.1); 
        transition: transform 0.2s; 
    }
    .card-turno:hover { transform: translateY(-2px); box-shadow: 0 10px 20px rgba(0,0,0,0.2); }
    
    .turno-header { display: flex; justify-content: space-between; font-size: 0.85rem; color: var(--text-muted); margin-bottom: 15px; border-bottom: 1px solid #334155; padding-bottom: 10px; text-transform: uppercase; letter-spacing: 0.5px; }
    .turno-body strong { display: block; font-size: 1.2rem; margin-bottom: 5px; color: white; }
    .meta { display: flex; flex-direction: column; gap: 5px; font-size: 0.9rem; color: #cbd5e1; }
    .turno-actions { display: flex; gap: 10px; margin-top: 20px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.05); }

    .btn-wsp { flex: 1; text-align: center; background: #22c55e; color: white; padding: 10px; border-radius: 8px; text-decoration: none; font-size: 0.9rem; font-weight: bold; display: flex; align-items: center; justify-content: center; gap: 8px; transition: 0.2s; }
    .btn-wsp:hover { background: #16a34a; }
    
    .btn-delete-sm { 
        background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.2); color: #ef4444; 
        border-radius: 8px; cursor: pointer; font-size: 1.2rem; padding: 0 15px; 
        transition: 0.2s; display: flex; align-items: center; justify-content: center; 
    }
    .btn-delete-sm:hover { background: #ef4444; color: white; }

    /* EDITORES DE LISTAS (SERVICIOS) */
    .list-editor { display: flex; flex-direction: column; gap: 15px; margin-bottom: 25px; }
    .row-editor { display: flex; gap: 10px; align-items: center; background: #1e293b; padding: 15px; border-radius: 12px; border: 1px solid var(--border); flex-wrap: wrap; }
    
    input { background: #0f172a; border: 1px solid #475569; color: white; padding: 12px; border-radius: 8px; outline: none; flex: 1; min-width: 0; font-size: 0.95rem; }
    input:focus { border-color: var(--barber-blue); box-shadow: 0 0 0 2px rgba(30, 58, 138, 0.3); }
    
    /* Nuevo grupo de botones para servicios */
    .service-actions-group { display: flex; gap: 10px; }

    /* BARBEROS (Grid Compleja) */
    .barber-card-wrapper { margin-bottom: 15px; border-radius: 12px; overflow: hidden; border: 1px solid var(--border); background: #1a2333; }
    .barber-main-row { display: flex; justify-content: space-between; align-items: center; padding: 15px; background: #243045; gap: 10px; flex-wrap: wrap; }
    .barber-name-group { display: flex; align-items: center; gap: 10px; flex: 1; min-width: 200px; }
    .name-input { font-size: 1.1rem; font-weight: bold; border: none !important; background: transparent !important; width: 100%; padding: 0 !important; box-shadow: none !important; }
    .barber-actions { display: flex; gap: 8px; }
    
    .week-config { display: none; background: #151e2e; padding: 20px; border-top: 1px solid var(--border); }
    .week-config.open { display: block; }
    .week-header { display: flex; justify-content: space-between; padding: 0 10px 10px; color: var(--text-muted); font-size: 0.8rem; text-transform: uppercase; font-weight: bold; border-bottom: 1px solid rgba(255,255,255,0.05); margin-bottom: 10px; }

    .day-row { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; background: rgba(255,255,255,0.02); padding: 10px 15px; border-radius: 8px; align-items: center; margin-bottom: 8px; border-left: 3px solid transparent; transition: 0.2s; }
    .day-row.day-active { border-left-color: #22c55e; background: rgba(34, 197, 94, 0.05); }
    .day-main, .day-break { display: flex; align-items: center; gap: 10px; flex-wrap: wrap; }
    .day-label { width: 40px; font-weight: bold; }
    .time-group { display: flex; align-items: center; gap: 5px; }
    .time-input { max-width: 90px; text-align: center; padding: 8px !important; }
    .time-xs { max-width: 70px; padding: 6px !important; font-size: 0.85rem !important; text-align: center; }
    .hidden { display: none !important; }

    /* BOTONES GLOBALES */
    .action-btn { border: none; border-radius: 8px; cursor: pointer; display: flex; align-items: center; justify-content: center; width: 45px; height: 45px; font-size: 1.3rem; transition: 0.2s; flex-shrink: 0; }
    .btn-save, .btn-save-barb { background: var(--barber-blue); color: white; }
    .btn-del-serv, .btn-del-barb { background: rgba(239, 68, 68, 0.2); color: #ef4444; border: 1px solid rgba(239, 68, 68, 0.3); }
    .btn-toggle-week { background: #334155; color: white; width: auto; padding: 0 15px; font-size: 0.9rem; font-weight: bold; gap: 5px; }
    .btn-toggle-week.active { background: #475569; }

    .add-form, .block-controls { display: flex; gap: 10px; flex-wrap: wrap; background: rgba(255,255,255,0.03); padding: 20px; border-radius: 12px; border: 1px dashed #475569; margin-top: 20px; }
    .add-form button, .btn-danger { background: #22c55e; color: white; border: none; padding: 12px 20px; border-radius: 8px; font-weight: bold; cursor: pointer; flex-grow: 1; min-width: 120px; }
    .btn-danger { background: var(--barber-red); }

    /* --- ESTILOS PARA REPORTE BONITO (RECUPERADOS) --- */
    .report-card { 
        background: #1e293b; 
        border: 1px solid #334155; 
        border-radius: 16px; 
        padding: 30px; 
        max-width: 650px; 
        margin: 20px auto; 
        box-shadow: 0 20px 50px rgba(0,0,0,0.3); 
    }
    
    .report-header { display: flex; align-items: center; gap: 15px; margin-bottom: 25px; border-bottom: 1px solid #334155; padding-bottom: 20px; }
    .report-header h3 { margin: 0; color: white; font-size: 1.3rem; }
    .icon-report { font-size: 1.8rem; background: rgba(30, 58, 138, 0.2); padding: 12px; border-radius: 12px; display: inline-block; }
    
    .filters-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px; }
    
    .filter-group { display: flex; flex-direction: column; gap: 8px; }
    .filter-group label { color: #94a3b8; font-size: 0.8rem; font-weight: bold; text-transform: uppercase; letter-spacing: 0.5px; }
    .filter-group:last-child { grid-column: 1 / -1; } 
    
    .input-dark { 
        background: #0f172a; 
        border: 1px solid #475569; 
        color: white; 
        padding: 14px; 
        border-radius: 8px; 
        font-size: 1rem; 
        outline: none; 
        width: 100%; 
        transition: 0.2s; 
    }
    .input-dark:focus { border-color: var(--barber-blue); box-shadow: 0 0 0 2px rgba(30, 58, 138, 0.3); }
    
    .report-footer { text-align: center; }
    
    /* ESTILO DEL BOT√ìN DE DESCARGA (RECUPERADO) */
    .btn-download-pro { 
        background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%); 
        color: white; 
        border: none; 
        padding: 16px 30px; 
        border-radius: 10px; 
        font-size: 1.1rem; 
        font-weight: bold; 
        cursor: pointer; 
        width: 100%; 
        box-shadow: 0 4px 15px rgba(34, 197, 94, 0.3); 
        transition: transform 0.2s, box-shadow 0.2s; 
        display: flex; align-items: center; justify-content: center; gap: 10px; 
    }
    .btn-download-pro:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(34, 197, 94, 0.5); filter: brightness(1.1); }
    .btn-download-pro:disabled { opacity: 0.6; cursor: not-allowed; transform: none; box-shadow: none; filter: grayscale(1); }
    
    .status-text { margin-top: 15px; font-size: 0.9rem; color: #fbbf24; min-height: 20px; }

    /* RESPONSIVE */
    @media (max-width: 700px) {
        .content-area { padding: 10px; }
        
        /* Ajuste para Servicios en Mobile */
        .row-editor { flex-direction: column; align-items: stretch; gap: 10px; }
        .row-editor input { width: 100%; }
        .service-actions-group { width: 100%; justify-content: space-between; }
        .service-actions-group button { flex: 1; } /* Botones grandes en mobile */

        .barber-actions { justify-content: space-between; margin-top: 10px; width: 100%; }
        .barber-actions button { flex: 1; }
        .day-row { grid-template-columns: 1fr; gap: 15px; padding: 15px; }
        .day-break { border-top: 1px dashed #334155; padding-top: 10px; width: 100%; margin-top: 5px; }
        .filters-grid { grid-template-columns: 1fr; }
        .report-card { padding: 20px; }
    }

    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    .loading, .empty { text-align: center; padding: 40px; color: var(--text-muted); font-size: 1.1rem; }
    .simple-list li { display: flex; justify-content: space-between; padding: 15px; border-bottom: 1px solid #334155; background: var(--bg-card); align-items: center; border-radius: 8px; margin-bottom: 5px; }
</style>